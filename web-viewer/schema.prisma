// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ModÃ¨le Guild - Configuration par serveur Discord
model Guild {
  id        String   @id // Discord Guild ID
  name      String
  prefix    String   @default("!")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // LOGS
  logsEnabled         Boolean @default(false)
  logsChannel         String?
  logsMessages        Boolean @default(false)
  logsModeration      Boolean @default(false)
  logsJoins           Boolean @default(false)
  logsLeaves          Boolean @default(false)
  logsRoles           Boolean @default(false)
  logsChannels        Boolean @default(false)
  logsBans            Boolean @default(false)
  logsBoosts          Boolean @default(false)

  // WELCOME
  welcomeEnabled      Boolean @default(false)
  welcomeChannel      String?
  welcomeMessage      String  @default("Bienvenue {user} ðŸ‘‹")
  welcomeImage        String?

  // BYE
  byeEnabled          Boolean @default(false)
  byeChannel          String?
  byeMessage          String  @default("{user} nous a quittÃ©â€¦ ðŸ˜¢")
  byeImage            String?

  // ANNONCES
  announcesEnabled    Boolean @default(false)
  announcesChannel    String?

  // TICKETS
  ticketEnabled       Boolean @default(false)
  ticketChannel       String?
  ticketCategory      String?
  ticketMessage       String?
  ticketRoleSupport   String?
  ticketLogs          String?

  // LEVELS
  levelEnabled        Boolean @default(false)
  levelChannel        String?
  levelMessage        String  @default("ðŸŽ‰ Bravo {user} ! Tu passes au niveau {level} !")
  levelMultiplier     Float   @default(1.0)

  // MODERATION
  modEnabled          Boolean @default(false)
  modRole             String?
  modLogChannel       String?
  autoModEnabled      Boolean @default(false)
  antiSpam            Boolean @default(false)
  antiLink            Boolean @default(false)

  // ROLES AUTO
  autoRoleEnabled     Boolean @default(false)
  autoRoleId          String?

  // Relations
  users               User[]

  @@map("guilds")
}

// ModÃ¨le User - DonnÃ©es utilisateur
model User {
  id                String    @id @default(uuid())
  discordId         String    // Discord User ID
  username          String
  guildId           String    // Discord Guild ID
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  birthday          String?
  
  // TICKETS
  hasTicket         Boolean   @default(false)
  ticketMessageId   String?

  // LEVELS
  level             Int       @default(0)
  xp                Int       @default(0)
  nextLevel         Int       @default(300)
  rank              String?

  // GUILD STATUS
  inGuild           Boolean   @default(true)
  leftAt            DateTime?

  // WARNINGS
  warnings          Warning[]

  // Relations
  guild             Guild     @relation(fields: [guildId], references: [id], onDelete: Cascade)

  @@unique([discordId, guildId])
  @@index([guildId])
  @@index([discordId])
  @@map("users")
}

// ModÃ¨le Warning - Avertissements
model Warning {
  id          String   @id @default(uuid())
  userId      String
  reason      String
  moderator   String   // Discord ID du modÃ©rateur
  createdAt   DateTime @default(now())

  // Relations
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("warnings")
}
